define("./../gadget/cmsMgrGadget",["./../breeze/framework/js/BreezeFW","./../breeze/framework/js/tools/Widget","./../breeze/framework/js/tools/DateTime"],function(require){var a=require("./../breeze/framework/js/BreezeFW");return require("./../breeze/framework/js/tools/Widget")(a),require("./../breeze/framework/js/tools/DateTime")(a),a.register({name:"cmsMgrGadget",param:{norole:!0,alias:"",id:"",nodeid:"",action:"",pagesize:10,plModSet:{xxalias:!0},plAddSetNum:10,listType:{xxalias:0},btnForList:{"default":[{title:"\u7f16\u8f91",action:"modData","class":"btn btn-mini btn-info",style:"display:none",html:" <i class='icon-edit bigger-120'> \u7f16\u8f91</i>",onclick:"privateBtnConEdit"},{title:"\u5220\u9664",action:"delData","class":"btn btn-mini btn-danger",style:"display:none",html:" <i class='icon-trash bigger-120'> \u5220\u9664</i>",onclick:"privateBtnConDel"}],roles:[{title:"\u6743\u9650\u8bbe\u7f6e","class":"btn btn-mini btn-success",html:" <i class='icon-group bigger-120'> \u6743\u9650</i>",onclick:"privateSetRoles"},{title:"\u7f16\u8f91",action:"modData","class":"btn btn-mini btn-info",style:"display:none",html:" <i class='icon-edit bigger-120'> \u7f16\u8f91</i>",onclick:"privateBtnConEdit"},{title:"\u5220\u9664",action:"delData","class":"btn btn-mini btn-danger",style:"display:none",html:" <i class='icon-trash bigger-120'> \u5220\u9664</i>",onclick:"privateBtnConDel"}]},viewConList:"viewContentList",viewConAdd:"viewContentAdd",viewConPLAdd:"viewContentPLAdd",viewClassEdit:"viewClassEdit",viewClassAdd:"viewClassAdd",viewConEdit:"viewContentEdit",formConList:"formContentList",formConAdd:"formContentAdd",formConPLAdd:"formContentPLAdd",formClassEdit:"formClassEdit",formClassAdd:"formClassAdd",formConEdit:"formContentEdit"},onCreate:function(){var a=this;a.API.private("privateSetGlobalVar"),a.API.private("privateGetNodeDesc"),a.API.private("privateContentDesc",a.MY.alias,function(t){a.API.private("privateGetSonDesc",function(){t.parent_alias==a.MY.alias&&(a.MY.isSelfAlias=!0),$("#aliasTitle").text(t.model_name),$("#aliasTitle").text(t.model_name),$("#pageH1").show(),a.API.private("privateShowDefaultView"),a.API.private("privateCheckAuth",$("body"))})})},FireEvent:{},"private":{privateSetGlobalVar:function(){var t=this;t.MY.alias=t.param.alias||a.use().getParameter("alias")||"",t.MY.action=t.param.action||a.use().getParameter("action")||"",t.MY.id=t.param.id||a.use().getParameter("id")||"",t.MY.nodeid=t.param.nodeid||a.use().getParameter("nodeid")||"",t.MY.isrole=t.param.norole||a.use().getParameter("norole")||"",t.MY.listType=t.param.listType[this.MY.alias]||a.use().getParameter("listType")||"",t.MY.contentDesc={},t.MY.sonAlias=t.param.sonAlias||a.use().getParameter("sonAlias")||"",t.MY.sonId=t.param.sonId||a.use().getParameter("sonId")||"",t.MY.isSelfAlias=!1,t.MY.noClass=!1,t.MY.act={conList:"conList",conAdd:"conAdd",conPLAdd:"conPLAdd",classEdit:"classEdit",classAdd:"classAdd",conEdit:"conEdit"},t.MY.package="cms",t.MY.serverName={aCon:"addData",dCon:"delData",mCon:"modData",qCon:"queryData",aModel:"addModel",dModel:"delModel",mModel:"modModel",qModel:"queryModel"}},privateGetNodeDesc:function(){var a=this,t={alias:a.MY.alias,target:"parent"};a.API.doServer(a.MY.serverName.qModel,a.MY.package,t,function(t,e){t>0&&e?(a.MY.nodeDesc=e.model_desc||{},a.MY.nodeDesc.id={type:"Hidden",title:"id",islist:"0"}):(a.MY.noClass=!0,$("#btnAction .btn-group:eq(1)").remove())})},privateGetSonDesc:function(a){var t=this,e={alias:t.MY.alias,target:"son"};t.API.doServer(t.MY.serverName.qModel,t.MY.package,e,function(e,i){if(e>0&&i){for(var n="",s=0;s<i.length;s++)n+="<li>",n+="<a href='javascript:void(0)' sonalias='"+i[s].alias+"' data-toggle='tab'>"+i[s].model_name+"</a>",n+="</li>";$("#tabSonAlias>ul>li:gt(0)").remove(),$("#tabSonAlias>ul").append(n),a&&a(),$("#tabSonAlias>ul>li>a").on("click",function(){if(!$(this).parent().hasClass("active")){var a=$("#tabSonAlias>ul>li>a").index($(this));0==a?(delete t.MY.sonAlias,$("#btnAddSonAlias").hide(),$("#btnPLAddSonAlias").hide(),t.API.private("privateShowConEdit")):(t.MY.sonAlias=$(this).attr("sonalias"),$("#btnAddSonAlias").show().on("click",function(){t.API.private("privateShowConAdd")}),$("#btnPLAddSonAlias").show().on("click",function(){t.API.private("privateShowConPLAdd"),t.API.find(".table_formlist:eq(0)").next().find(".btn-add-con").show()}),t.API.private("privateContentDesc",t.MY.sonAlias,function(){t.API.private("privateShowConList")}))}})}})},privateContentDesc:function(a,t){var e=this;e.API.doServer(e.MY.serverName.qModel,e.MY.package,{alias:a},function(i,n){i>0&&n&&(e.MY.contentDesc[a]=n.model_desc,e.MY.contentDesc[a].id||(e.MY.contentDesc[a].id={type:"Hidden",title:"id",islist:"1"}),t&&t(n))})},privateShowDefaultView:function(){this.MY.action==this.MY.act.conAdd?(a.trigerEvent("trigerReShowNodeTree",this.MY.alias),this.API.private("privateShowConAdd")):this.MY.action==this.MY.act.conPLAdd?(a.trigerEvent("trigerReShowNodeTree",this.MY.alias),this.API.private("privateShowConPLAdd")):this.MY.action==this.MY.act.classAdd?(a.trigerEvent("trigerReShowNodeTree",this.MY.alias),this.MY.isding=!0,this.API.private("privateShowClassAdd")):this.MY.action==this.MY.act.conEdit?(a.trigerEvent("trigerReShowNodeTree",this.MY.alias),this.API.private("privateShowConEdit")):this.MY.action==this.MY.act.classEdit&&this.MY.nodeid?(a.trigerEvent("trigerReShowNodeTree",this.MY.alias),this.API.private("privateShowClassEdit")):(a.trigerEvent("trigerReShowNodeTree",this.MY.alias),this.API.private("privateShowConList"))},privateOutLinkCB:function(a,t,e,i,n){function s(a,t,e){o.API.private("privateContentDesc",t.alias,function(i){v||(v="\u8bf7\u9009\u62e9"+i.model_name),o.API.private("privateBindFormListPage",f,t,2,function(){a.empty(),f.appendTo(a),e&&e()})})}var o=this,r=/data.formList\[(.*?)\].*?/g.exec(e),d=null==r?-1:r[1];e=e.split(".")[e.split(".").length-1];var l=a[e].outerLink;if(2===l.split(".").length){var c=l.split(".")[0],v=(l.split(".")[1],""),u={alias:c,filterParam:{},orderBy:[{fieldName:"id",isDesc:!0}]};$("#newViewDom").length||($("body").append("<div style='display:none;' id='newViewDom'></div>"),$("body").append("<div id='preOuterLinkEditForm'></div>"));var p=$("#newViewDom"),f=$("#preOuterLinkEditForm");o.API.private("privateSetOutlinkView",p,u,d,function(a,t){s(a,t)},function(r,l,u){u&&(v=u),s(r,l,function(){o.API.private("privateMaskLayer",p,v,1e3,function(){var s=f[0].batchEdit();if(s.length){var r=t[0].getData();if((o.MY.action==o.MY.act.conPLAdd||o.MY.action==o.MY.act.conList)&&(r=t[0].getData().formList),r){for(var l in a)if(a[l].outerLink){var v=a[l].outerLink.split(".");if(2!==v.length)return;var u=v[0],p=v[1];u==c&&(-1!==d?r[d][l]=s[0][p]:r[l]=s[0][p])}o.API.private("privateMessOutLinkOk",a,t,e,i,r),n&&n(r)}}})})})}},privateMessOutLinkOk:function(){},privateSetOutlinkView:function(a,t,e,i,n){n&&n(a,t)},privateMaskLayer:function(t,e,i,n){var s="<div style='text-align:left;cursor:default; background:#fff; padding:10px;'><div class='modal-header' style='margin-bottom:20px;'><h3>"+e+"</h3></div>";if(s+="<div class='modal-body'><form id='outerLinkEditForm' class='form-horizontal outlinkform_"+this.MY.alias+" clearfix' style='margin:0px;'></form></div>",n){if(s+="<div class='modal-footer'>",n instanceof Function&&(s+="<a href='javascript:;' class='btn btn btn-small btn-success'><i class='icon-ok bigger-110'></i> \u4fdd\u5b58</a>",s+="<a href='javascript:;' class='btn btn btn-small'><i class='icon-undo bigger-110'></i> \u53d6\u6d88</a>"),"[object Array]"===toString.apply(n))for(var o=0;o<n.length;o++)s+=n[o].html;s+="</div>"}s+="</div>",a.blockUI(s,($(window).width()-i)/2,100,i,"auto",0),t.appendTo($("#outerLinkEditForm")).show(),$("#outerLinkEditForm").find(".form-wrap").removeClass("pull-left"),$(".chosen-select").chosen(),n&&$(".modal-footer>a").click(function(){var t=$(".modal-footer>a").index($(this));n instanceof Function&&(a.unblockUI(),0==t&&n&&n()),"[object Array]"===toString.apply(n)&&n[t].callback&&n[t].callback()})},privateSetDescAndData:function(a,t,e){e&&e()},privateDataToForm:function(t,e){if(e&&e.length)for(var i in t)for(var n=0;n<e.length;n++)e[n][i]&&(-1!=$.inArray(t[i].type,["List","Pics","CheckBox","MultSelect"])?"string"===e[n][i]&&(e[n][i]=a.use().evalJSON(e[n][i])):"DatePicker"==t[i].type?e[n][i]=a.use("DateTime").format(new Date(e[n][i]),"yyyy-MM-dd"):"DateTimePicker"==t[i].type&&(e[n][i]=a.use("DateTime").format(new Date(e[n][i]),"yyyy-MM-dd hh:mm:ss")))},privateFormToData:function(t,e){if(e)for(var i in t)if(-1!=$.inArray(t[i].type,["List","Pics","CheckBox","MultSelect"])){if(!e[i])continue;e[i]=a.use().toJSONString(e[i])}},privateShowConList:function(){var a=this;if(a.MY.sonAlias){var t=a.MY.id,e=a.MY.sonAlias,i=$("#tabSonAlias>ul>li>a[sonalias='"+a.MY.sonAlias+"']"),n=$("#tabSonAlias>ul>li>a").index(i);$("#tabSonAlias>ul>li").removeClass("active").eq(n).addClass("active"),$("#tabSonAlias").show(),$("#btnAddSonAlias").show(),$("#btnPLAddSonAlias").show()}else{var t=a.MY.nodeid,e=a.MY.alias;$("#tabSonAlias").hide(),$("#btnAddSonAlias").hide(),$("#btnPLAddSonAlias").hide(),a.MY.id=""}a.param.plModSet[e]||$("#submitBtn").hide(),a.MY.action=a.MY.act.conList,a.API.private("privatePushState",{action:a.MY.action,alias:a.MY.alias,sonAlias:a.MY.sonAlias,nodeid:a.MY.nodeid,id:a.MY.id,sonId:""}),$("#actionName").text("\u5185\u5bb9\u5217\u8868"),a.API.show(a.param.viewConList);var s=a.API.find("#"+a.param.formConList);a.param.plModSet[e]?s.addClass(e+"_editConList").addClass("editConList"):s.addClass(e+"_"+a.MY.action).addClass(a.MY.action);var o={alias:e,filterParam:{},orderBy:[{fieldName:"id",isDesc:!0}]};t&&(o.filterParam.nodeid=t),a.API.private("privateBindFormListPage",s,o,a.MY.listType||0,function(t){a.API.private("privateShowConListCB",t)})},privateShowConListCB:function(t){function e(a){for(var e=0;e<a.length;e++){var n="<a href='javascript:void(0);' ";!function(e){for(var o in a[e])if("onclick"==o.toLowerCase())var r=a[e][o];else if("html"==o)var d=a[e][o];else n+="action"==o?"data-action='"+a[e][o]+"' ":o+"='"+a[e][o]+"' ";n+=">",$(n+d+"</a>").appendTo(s.find("table:eq(0)>tbody>tr>td>.actionBtnForList")).on("click",function(){var a=s.find("table:eq(0)>tbody>tr>td>.actionBtnForList").index($(this).parents(".actionBtnForList"));i.API.private(r,$(this),t[a])})}(e)}}var i=this;if(i.MY.sonAlias)var n=(i.MY.id,i.MY.sonAlias);else var n=(i.MY.nodeid,i.MY.alias);var s=i.API.find("#"+i.param.formConList);s.find("table:eq(0)>tbody>tr>td>label>input[type='checkbox']").on("click",function(){var e=s.find("table:eq(0)>tbody>tr>td>label>input[type='checkbox']").index($(this));a.trigerEvent("trigerCheckBoxClick",t[e])}),i.param.btnForList&&i.param.btnForList[n]?e(i.param.btnForList[n]):i.param.btnForList&&i.param.btnForList.default&&e(i.param.btnForList.default),s.find(".btn-del-list").on("click",function(){i.API.private("privateBtnConPLDel")}),i.API.private("privateCheckAuth",s),i.API.private("privateMessConListOk",t),i.param.plModSet[n]&&setTimeout(function(){$("#submitBtn").fadeIn(150)},315)},privateMessConListOk:function(){},privateBindFormListPage:function(t,e,i,n){var s=this;e=s.API.private("privateSetListParam",e),e.resultSet="count",s.API.doServer(s.MY.serverName.qCon,s.MY.package,e,function(o,r){function d(o){a.use().save(v,o);var r=parseInt(o);e.resultSet="",e.limit=(c*r-c).toString()+","+c.toString(),s.API.doServer(s.MY.serverName.qCon,s.MY.package,e,function(o,v){o>0&&s.API.private("privateContentDesc",e.alias,function(){function o(u){s.API.private("privateSetDescAndData",e.alias,u,function(){var p=a.clone(s.MY.contentDesc[e.alias]);$.each(p,function(a,t){return 0==t.islist?!0:(-1!=$.inArray(t.type,["Select","Radio"])?(t.type="Text",valueRange=t.valueRange[0],$.each(u,function(t,e){$.each(valueRange,function(t,i){return e[a]==i?(e[a]=t,!1):void 0})})):-1!=$.inArray(t.type,["CheckBox","MultSelect"])?(t.type="Text",valueRange=t.valueRange[0],$.each(u,function(t,e){return e[a]?($.each(valueRange,function(t,i){var n=$.inArray(i,e[a]);-1!=n&&(e[a][n]=t)}),e[a]=e[a].join("\u3001"),void 0):!0})):"TextArea"==t.type&&(t.type="Text"),void 0)}),a.use().createFormList(p,t,u,function(a,e){s.API.private("privateOutLinkCB",p,t,a,e,function(a){o(a)})},i),a.use().showPagination(t.find("#pagination"),l,c,r,function(a){d(a)}),n&&n(v.listData)})}s.API.private("privateDataToForm",s.MY.contentDesc[e.alias],v.listData),o(v.listData)})})}if(o>0&&r){var l=parseInt(r.listCount)||0;if(l){var c=s.param.pagesize||20,v=e.filterParam.nodeid?e.alias+e.filterParam.nodeid:e.alias,u=parseInt(a.use().load(v))||1;u>Math.ceil(l/c)&&(u=Math.ceil(l/c)),d(u)}else s.API.private("privateContentDesc",e.alias,function(){s.API.private("privateSetDescAndData",e.alias,null,function(){a.use().createFormList(s.MY.contentDesc[e.alias],t,null,function(a,i){s.API.private("privateOutLinkCB",s.MY.contentDesc[e.alias],t,a,i)},i),a.use().showPagination(t.find("#pagination")),n&&n([])})})}})},privateSetListParam:function(a){return a},privateShowConAdd:function(){function t(i){e.API.private("privateSetDescAndData",n,i,function(){a.use().createForm(e.MY.contentDesc[n],r,i,function(a,i){e.API.private("privateOutLinkCB",e.MY.contentDesc[n],r,a,i,function(a){t(a)})})})}var e=this;if(e.MY.sonAlias)var i=e.MY.id,n=e.MY.sonAlias;else{var i=e.MY.nodeid,n=e.MY.alias;e.MY.id=""}if(!i&&!e.MY.noClass)return a.use("Widget").alert("\u8bf7\u5148\u9009\u62e9\u680f\u76ee!","warning"),void 0;if(e.MY.sonAlias){var i=e.MY.id,n=e.MY.sonAlias,s=$("#tabSonAlias>ul>li>a[sonalias='"+e.MY.sonAlias+"']"),o=$("#tabSonAlias>ul>li>a").index(s);$("#tabSonAlias>ul>li").removeClass("active").eq(o).addClass("active"),$("#tabSonAlias").show()}else{var i=e.MY.nodeid,n=e.MY.alias;$("#tabSonAlias").hide()}$("#btnAddSonAlias").hide(),$("#btnPLAddSonAlias").hide(),e.MY.action=e.MY.act.conAdd,e.API.private("privatePushState",{action:e.MY.action,alias:e.MY.alias,sonAlias:e.MY.sonAlias,nodeid:e.MY.nodeid,id:e.MY.id,sonId:""}),$("#actionName").text("\u5185\u5bb9\u6dfb\u52a0"),e.API.show(e.param.viewConAdd);var r=e.API.find("#"+e.param.formConAdd);r.addClass(n+"_"+e.MY.action).addClass(e.MY.action),t(null),e.API.private("privateMessConAddOk"),setTimeout(function(){$("#submitBtn").fadeIn(150)},150)},privateMessConAddOk:function(){},privateShowConPLAdd:function(){function t(i){e.API.private("privateSetDescAndData",n,i,function(){a.use().createFormList(e.MY.contentDesc[n],r,i,function(a,i){e.API.private("privateOutLinkCB",e.MY.contentDesc[n],r,a,i,function(a){t(a)})},1)})}var e=this;if(e.MY.sonAlias)var i=e.MY.id,n=e.MY.sonAlias;else{var i=e.MY.nodeid,n=e.MY.alias;e.MY.id=""}if(!i&&!e.MY.noClass)return a.use("Widget").alert("\u8bf7\u5148\u9009\u62e9\u680f\u76ee!","warning"),void 0;if(e.MY.sonAlias){var s=$("#tabSonAlias>ul>li>a[sonalias='"+e.MY.sonAlias+"']"),o=$("#tabSonAlias>ul>li>a").index(s);$("#tabSonAlias>ul>li").removeClass("active").eq(o).addClass("active"),$("#tabSonAlias").show()}else $("#tabSonAlias").hide();$("#btnAddSonAlias").hide(),$("#btnPLAddSonAlias").hide(),e.MY.action=e.MY.act.conPLAdd,e.API.private("privatePushState",{action:e.MY.action,alias:e.MY.alias,sonAlias:e.MY.sonAlias,id:e.MY.id,nodeid:e.MY.nodeid,sonId:""}),$("#actionName").text("\u5185\u5bb9\u6279\u91cf\u6dfb\u52a0"),e.API.show(e.param.viewConPLAdd);var r=e.API.find("#"+e.param.formConPLAdd);r.addClass(n+"_"+e.MY.action).addClass(e.MY.action);var d=[],l={};for(var c in e.MY.contentDesc[n])l[c]="";for(var v=0;v<e.param.plAddSetNum;v++)d.push(l);t(d),e.API.private("privateMessConPLAddOk"),setTimeout(function(){$("#submitBtn").fadeIn(150)},150)},privateMessConPLAddOk:function(){},privateShowConEdit:function(){var t=this;if($("#tabSonAlias").show(),t.MY.sonAlias){var e=t.MY.sonAlias,i=t.MY.sonId,n=$("#tabSonAlias>ul>li>a[sonalias='"+t.MY.sonAlias+"']"),s=$("#tabSonAlias>ul>li>a").index(n);$("#tabSonAlias>ul>li").removeClass("active").eq(s).addClass("active")}else{var e=t.MY.alias,i=t.MY.id;$("#tabSonAlias>ul>li").removeClass("active").eq(0).addClass("active"),t.MY.sonId=""}$("#btnAddSonAlias").hide(),$("#btnPLAddSonAlias").hide(),t.MY.action=t.MY.act.conEdit,t.API.private("privatePushState",{action:t.MY.action,alias:t.MY.alias,sonAlias:t.MY.sonAlias,id:t.MY.id,nodeid:t.MY.nodeid,sonId:t.MY.sonId}),$("#actionName").text("\u5185\u5bb9\u4fee\u6539"),t.API.show(t.param.viewConEdit);var o=t.API.find("#"+t.param.formConEdit);o.addClass(e+"_"+t.MY.action).addClass(t.MY.action);var r={alias:e,filterParam:{id:i}};t.API.doServer(t.MY.serverName.qCon,t.MY.package,r,function(i,n){i>0&&n&&n.listData&&("model"!=t.MY.alias&&(t.MY.sonAlias?t.MY.sonAlias=n.listData[0].alias:t.MY.alias=n.listData[0].alias),t.API.private("privateContentDesc",e,function(){function i(n){t.API.private("privateSetDescAndData",e,n,function(){a.use().createForm(t.MY.contentDesc[e],o,n,function(a,n){t.API.private("privateOutLinkCB",t.MY.contentDesc[e],o,a,n,function(a){i(a)})})})}t.API.private("privateDataToForm",t.MY.contentDesc[e],n.listData),i(n.listData[0]),t.API.private("privateMessConEditOk",n.listData[0]),setTimeout(function(){$("#submitBtn").fadeIn(150)},150)}))})},privateMessConEditOk:function(){},privateShowClassEdit:function(){var t=this;if(!t.MY.nodeid)return a.use("Widget").alert("\u8bf7\u5148\u9009\u62e9\u680f\u76ee!","warning"),void 0;$("#tabSonAlias").hide(),$("#btnAddSonAlias").hide(),$("#btnPLAddSonAlias").hide(),t.MY.action=t.MY.act.classEdit,t.MY.sonAlias="",t.MY.id="",t.MY.sonId="",t.API.private("privatePushState",{action:t.MY.action,alias:t.MY.alias,sonAlias:"",nodeid:t.MY.nodeid,id:"",sonId:""}),$("#actionName").text("\u680f\u76ee\u4fee\u6539"),t.API.show(t.param.viewClassEdit);var e=t.API.find("#"+t.param.formClassEdit);e.addClass(t.MY.alias+"_"+t.MY.action).addClass(t.MY.action);var i={alias:t.MY.alias,target:"parent",filterParam:{id:t.MY.nodeid}};t.API.doServer(t.MY.serverName.qCon,t.MY.package,i,function(i,n){function s(i){a.use().createForm(t.MY.nodeDesc,e,i,function(a,i){t.API.private("privateOutLinkCB",t.MY.nodeDesc,e,a,i,function(a){s(a)})})}i>0&&n.listData&&(t.API.private("privateDataToForm",t.MY.contentDesc[t.MY.alias],n.listData),s(n.listData[0]),t.API.private("privateMessClassEditOk"),setTimeout(function(){$("#submitBtn").fadeIn(150)},150))})},privateMessClassEditOk:function(){},privateShowClassAdd:function(){function t(n){a.use().createForm(e.MY.nodeDesc,i,n,function(a,n){e.API.private("privateOutLinkCB",e.MY.nodeDesc,i,a,n,function(a){t(a)})})}var e=this;if(!e.MY.isding&&!e.MY.nodeid)return a.use("Widget").alert("\u8bf7\u5148\u9009\u62e9\u680f\u76ee!","warning"),void 0;$("#tabSonAlias").hide(),$("#btnAddSonAlias").hide(),$("#btnPLAddSonAlias").hide(),e.MY.action=e.MY.act.classAdd,e.MY.sonAlias="",e.MY.id="",e.MY.sonId="",e.API.private("privatePushState",{action:e.MY.action,alias:e.MY.alias,sonAlias:"",nodeid:e.MY.nodeid,id:"",sonId:""}),e.MY.isding?$("#actionName").text("\u6dfb\u52a0\u9876\u680f\u76ee"):$("#actionName").text("\u6dfb\u52a0\u5b50\u680f\u76ee"),e.API.show(e.param.viewClassAdd);var i=e.API.find("#"+e.param.formClassAdd);i.addClass(e.MY.alias+"_"+e.MY.action).addClass(e.MY.action),t(null),e.API.private("privateMessClassAddOk"),setTimeout(function(){$("#submitBtn").fadeIn(150)},150)},privateMessClassAddOk:function(){},privateBtnConEdit:function(a,t){this.MY.sonAlias?this.MY.sonId=t.id:this.MY.id=t.id,this.API.private("privateShowConEdit")},privateBtnConDel:function(t,e){var i=this,n=i.MY.sonAlias||i.MY.alias;if(confirm("\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5185\u5bb9\u5417\uff1f")){var s={alias:n,id:e.id},o="model"==n?i.MY.serverName.dModel:i.MY.serverName.dCon;i.API.doServer(o,i.MY.package,s,function(t){t>0?i.API.private("privateShowConList"):a.use("Widget").alert("\u5185\u5bb9\u5220\u9664\u5931\u8d25\uff01","danger")})}},privateBtnConPLDel:function(){var t=this,e=t.API.find("#"+t.param.formConList),i=t.MY.sonAlias||t.MY.alias;if(confirm("\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5185\u5bb9\u5417\uff1f")){for(var n=e[0].batchEdit(),s=[],o=0;o<n.length;o++)s.push(n[o].id);var r={alias:i,id:s.join(",")},d="model"==i?t.MY.serverName.dModel:t.MY.serverName.dCon;t.API.doServer(d,t.MY.package,r,function(e){e>0?t.API.private("privateShowConList"):a.use("Widget").alert("\u5220\u9664\u5931\u8d25\uff01","danger")})}},privateCheckAuth:function(a){if(this.MY.isrole)$("[data-action]").show();else{var t=this.MY.sonAlias||this.MY.alias;if(!t||!window.RFBRoles)return;a.find("[data-action]").each(function(){var a=t+"."+$(this).data("action");~$.inArray(a,window.RFBRoles)&&$(this).show()})}},privateSubmitConList:function(t){var e=this,i=e.MY.sonAlias||e.MY.alias;if(e.param.plModSet[i]){var n=e.API.find("#"+e.param.formConList)[0].getDataAndCheck();if(n&&(n=n.formList,n.length)){for(var s=0;s<n.length;s++)e.API.private("privateFormToData",e.MY.contentDesc[i],n[s]);e.API.initPost();for(var o=[],s=0;s<n.length;s++)!function(t){e.API.addPost(e.MY.serverName.mCon,e.MY.package,{alias:i,keyValue:n[t]},function(e,i){e>0?o.push(i):a.use("Widget").alert("Cid="+n[t].id+":\u4fee\u6539\u5931\u8d25\uff01","danger")})}(s);e.API.doPost(function(){t&&t()})}}},privateSubmitConAdd:function(t){var e=this,i=e.API.find("#"+e.param.formConAdd)[0].getDataAndCheck();if(i){if(e.MY.sonAlias)var n=e.MY.id,s=e.MY.sonAlias;else var n=e.MY.nodeid,s=e.MY.alias;e.API.private("privateFormToData",e.MY.contentDesc[s],i);var o={alias:s,keyValue:i},r=e.MY.serverName.aCon;i.nodeid=n||"0",e.API.doServer(r,e.MY.package,o,function(e,i){e>0?t&&t(i):a.use("Widget").alert("\u5185\u5bb9\u6dfb\u52a0\u5931\u8d25\uff01","danger")})}},privateSubmitConPLAdd:function(t){var e=this,i=e.API.find("#"+e.param.formConPLAdd)[0].getDataAndCheck();if(i&&(i=i.formList,i.length)){if(e.MY.sonAlias)var n=e.MY.id,s=e.MY.sonAlias;else var n=e.MY.nodeid,s=e.MY.alias;for(var o=0;o<i.length;o++)e.API.private("privateFormToData",e.MY.contentDesc[s],i[o]);for(var r=[],d=e.API.find("#"+e.param.formConPLAdd)[0].getHiddenData(),o=0;o<i.length;o++){var l=!1;for(var c in i[o])i[o][c]!==d[0][c]&&(l=!0);l&&(i[o].nodeid=n,r.push(i[o]))}if(r.length){var v={alias:s,keyValue:r};e.API.doServer(e.MY.serverName.aCon,e.MY.package,v,function(e,i){e>0&&i?t&&t(i):a.use("Widget").alert("\u6570\u636e\u6dfb\u52a0\u5931\u8d25\uff01","danger")})}}},privateSubmitConEdit:function(t){var e=this,i=e.API.find("#"+e.param.formConEdit)[0].getDataAndCheck();if(i){var n=e.MY.sonAlias||e.MY.alias;e.API.private("privateFormToData",e.MY.contentDesc[n],i);var s={alias:n,keyValue:i},o=e.MY.serverName.mCon;e.API.doServer(o,e.MY.package,s,function(e){e>0?t&&t():a.use("Widget").alert("\u4fee\u6539\u5185\u5bb9\u4fdd\u5b58\u5931\u8d25\uff01","danger")})}},privateSubmitClassEdit:function(t){var e=this,i=e.API.find("#"+e.param.formClassEdit)[0].getDataAndCheck();if(i){e.API.private("privateFormToData",e.MY.nodeDesc,i);var n={alias:e.MY.alias,target:"parent",keyValue:i};e.API.doServer(e.MY.serverName.mCon,e.MY.package,n,function(e){e>0?t&&t():a.use("Widget").alert("\u4fee\u6539\u680f\u76ee\u4fdd\u5b58\u5931\u8d25\uff01","danger")})}},privateSubmitClassAdd:function(t){var e=this,i=e.API.find("#"+e.param.formClassAdd)[0].getDataAndCheck();if(i){i.nodeid=e.MY.isding?0:e.MY.nodeid,i.store_id=1,e.API.private("privateFormToData",e.MY.nodeDesc,i);var n={alias:e.MY.alias,target:"parent",keyValue:i};e.API.doServer(e.MY.serverName.aCon,e.MY.package,n,function(e,i){e>0&&i?t(i):a.use("Widget").alert("\u6dfb\u52a0\u680f\u76ee\u4fdd\u5b58\u5931\u8d25\uff01","danger")})}},privatePushState:function(){}},TrigerEvent:{trigerSubmit:function(){var t=this;t.MY.action==t.MY.act.conList?t.API.private("privateSubmitConList",function(){a.use("Widget").alert("\u4fee\u6539\u5b8c\u6210!","success"),t.API.private("privateShowDefaultView")}):t.MY.action==t.MY.act.conAdd?t.API.private("privateSubmitConAdd",function(){a.use("Widget").alert("\u5185\u5bb9\u6dfb\u52a0\u6210\u529f\uff01","success"),t.API.private("privateShowDefaultView")}):t.MY.action==t.MY.act.conPLAdd?t.API.private("privateSubmitConPLAdd",function(){a.use("Widget").alert("\u6dfb\u52a0\u5b8c\u6210!","success"),t.API.private("privateShowDefaultView")}):t.MY.action==t.MY.act.conEdit?t.API.private("privateSubmitConEdit",function(){a.use("Widget").alert("\u4fdd\u5b58\u6210\u529f\uff01","success"),t.API.private("privateShowDefaultView")}):t.MY.action==t.MY.act.classEdit?t.API.private("privateSubmitClassEdit",function(){a.use("Widget").alert("\u4fdd\u5b58\u6210\u529f\uff01","success"),a.trigerEvent("trigerReShowNodeTree",t.MY.alias),t.API.private("privateShowDefaultView")}):t.MY.action==t.MY.act.classAdd?t.API.private("privateSubmitClassAdd",function(){a.use("Widget").alert("\u680f\u76ee\u6dfb\u52a0\u6210\u529f\uff01","success"),setTimeout(function(){window.location.reload()},1500)}):t.API.private("privateSubmit_"+t.MY.action)},trigerChangeClass:function(a,t){var e=this;e.MY.nodeid=a,delete this.MY.sonAlias,e.MY.isSelfAlias?e.API.private("privateShowClassEdit"):(t&&(e.MY.alias=t),e.API.private("privateContentDesc",e.MY.alias,function(){e.API.private("privateShowConList")}))},trigerContentList:function(){delete this.MY.sonAlias,this.API.private("privateShowConList")},trigerContentAdd:function(){delete this.MY.sonAlias,this.API.private("privateShowConAdd")},trigerContentPLAdd:function(){delete this.MY.sonAlias,this.API.private("privateShowConPLAdd")},trigerClassEdit:function(){this.API.private("privateShowClassEdit")},trigerClassAdd:function(a){this.MY.isding="0"==a?!0:!1,this.API.private("privateShowClassAdd")},trigerClassDel:function(){if(!this.MY.nodeid)return a.use("Widget").alert("\u8bf7\u5148\u9009\u62e9\u680f\u76ee","warning"),void 0;var t={alias:this.MY.alias,target:"parent",id:this.MY.nodeid};confirm("\u786e\u5b9a\u8981\u5220\u9664\u8be5\u680f\u76ee\u5417\uff1f")&&this.API.doServer(this.MY.serverName.dCon,this.MY.package,t,function(t,e){t>0&&e?(a.use("Widget").alert("\u680f\u76ee\u5220\u9664\u6210\u529f\uff01","success"),this.MY.nodeid="",this.API.private("privatePushState",{nodeid:""}),setTimeout(function(){window.location.reload()},1500)):a.use("Widget").alert("\u680f\u76ee\u5220\u9664\u5931\u8d25\uff01","success")})},trigerGoBack:function(){this.API.private("privateShowConList")},trigerReset:function(){this.API.private("privateShowDefaultView")},trigerCheckBoxClick:function(){}}}),a}),define("",["./../breeze/framework/js/BreezeFW","./../breeze/framework/js/tools/Widget","./../breeze/framework/js/tools/DateTime","./../gadget/cmsMgrGadget"],function(require){var a=require("./../breeze/framework/js/BreezeFW");return require("./../breeze/framework/js/tools/Widget")(a),require("./../breeze/framework/js/tools/DateTime")(a),require("./../gadget/cmsMgrGadget"),a.register({param:{navTxt:{card:["\u4f1a\u5458\u7ba1\u7406","\u4f1a\u5458\u5237\u5361"]}},name:"useCardGadget","extends":["cmsMgrGadget"],onCreate:function(){$(".cateName",window.parent.document).text("\u4f1a\u5458\u7ba1\u7406"),$(".aliasName",window.parent.document).text("\u4f1a\u5458\u5237\u5361"),this.API.private("privateSetGlobalVar"),this.API.show("viewUseCardGadget"),this.API.private("bindTabEvent")},"private":{updateUserInfo:function(a){var t=this;switch(t.MY.userInfo=a,a.user_head&&$("#user_head").attr("src",a.user_head),a.amount=(a.amount/100).toFixed(2),a.discount=(a.discount/10).toFixed(1),a.user_sex=1==a.user_sex?"\u7537":"\u5973",a.status){case 0:a.status="\u672a\u6fc0\u6d3b";break;case 1:a.status="\u6b63\u5e38\u4f7f\u7528";break;case-1:a.status="\u5df2\u6302\u5931";break;case-999:a.status="\u5df2\u9500\u6237"}for(var e=["no","amount","score","card_rank_name","discount","status","store_name","comment","user_name","user_phone","user_mail","user_sex","user_birthday","user_address"],i=0;i<e.length;i++){var n="<b>"+a[e[i]]+"</b>";this.API.find("#"+e[i]).html(n)}},outerBox:function(t,e,i){var n=this;$("body").append('<div id="J_outBoxWrap" style="width:0;height:0;overflow:hidden;"><form id="J_outBox" class="form-horizontal clearfix modal-body"></form></div>');var s=$("#J_outBox");n.API.private("privateBindFormListPage",s,e,2,function(){a.use("Widget").prompt(s,t,function(){var a=s[0].batchEdit();a.length&&i&&i(a)},!0),$("#J_outBoxWrap").remove(),$("#J_outBox").delegate("tbody>tr","click",function(){$(this).find('input[name="rowRadio"]').attr("checked","checked")})})},searchUserInfo:function(){var t=a.use().toJSONString($("#J_inpSerVal").val());if(!this.MY.userKey||this.MY.userKey!=t){this.MY.userKey=t;var e={alias:"card",target:"self",tableWhere:"(nw_card.no = "+t+" or nw_user.phone = "+t+") and nw_card.status = 1",otherFields:[{keyField:"user_id",tableName:"nw_user",fields:{name:"user_name",head:"user_head",sex:"user_sex",birthday:"user_birthday",address:"user_address",phone:"user_phone",mail:"user_mail"}},{keyField:"store_id",tableName:"nw_store",fields:{name:"store_name"}},{keyField:"card_rank_id",tableName:"nw_card_rank",fields:{discount:"discount",name:"card_rank_name"}}]};this.API.doServer("queryData","cms",e,function(t,e){if(t>0&&e.listData&&e.listData[0]){var i=e.listData[0];this.API.private("updateUserInfo",i),this.API.find(".nav-tabs li a").attr("data-toggle","tab")}else a.use("Widget").alert("\u67e5\u65e0\u6570\u636e!","danger",1200)})}},bindTabEvent:function(){var t=this,e=this.API.find(".nav-tabs li");e.on("click",function(){if(!t.MY.userInfo)return a.use("Widget").alert("\u8bf7\u5148\u5237\u5361","warning"),void 0;var e=$(this).find("a").attr("href").substring(1);if(e&&"user"!=e&&"true"!=$(this).attr("data-status")){$(this).attr("data-status","true");var i=$('<form class="form-horizontal clearfix modal-body hidden"></form>');i.appendTo($("#"+e));var n;n="cash_record"==e||"prepaid_record"==e?"nw_"+e+".card_no = "+t.MY.userInfo.no:"nw_"+e+".user_id = "+t.MY.userInfo.user_id;var s={alias:e,tableWhere:n,filterParam:{},orderBy:[{fieldName:"id",isDesc:!0}]};t.API.private("privateBindFormListPage",i,s,2,function(){i.removeClass("hidden")})}})}},FireEvent:{fireSearchUser:function(){this.API.private("searchUserInfo")},fireSerBoxUser:function(){var a=this,t={alias:"card",filterParam:{},orderBy:[{fieldName:"id",isDesc:!0}]};this.API.private("outerBox","\u5feb\u901f\u9009\u62e9\u4f1a\u5458",t,function(t){$("#J_inpSerVal").val(t[0].no),a.API.private("searchUserInfo"),$.unblockUI()})},fireOpenPage:function(t){return this.MY.userInfo?("SPXF"==t?location.href="cash.html?card_no="+this.MY.userInfo.no:"XZJZ"==t?location.href="cmsadd.html?alias=case&action=conAdd&user_id="+this.MY.userInfo.user_id+"&user_name="+this.MY.userInfo.user_name:"XZYY"==t?location.href="cmsadd.html?alias=reservation&action=conAdd&user_id="+this.MY.userInfo.user_id+"&user_name="+this.MY.userInfo.user_name:"HYCZ"==t?location.href="cmsadd.html?alias=prepaid_record&action=conAdd&card_no="+this.MY.userInfo.no+"&user_name="+this.MY.userInfo.user_name:"JFBD"==t?location.href="scoreoper.html?alias=score_record&card_no="+this.MY.userInfo.no:"FSDX"==t?location.href="sendsms.html?alias=sms_record&action=conAdd&phones="+this.MY.userInfo.user_phone:"MMXG"==t?location.href="modpsd.html?card_no="+this.MY.userInfo.no:"GSJG"==t?location.href="cardstatus.html?card_no="+this.MY.userInfo.no:"HYHK"==t&&(location.href="cardchange.html?card_no="+this.MY.userInfo.no),void 0):(a.use("Widget").alert("\u8bf7\u5148\u8f93\u5165\u5361\u53f7","warning"),void 0)}},TrigerEvent:{}}),a});